### 第三章 常用命令
<br>

#### 数值操作：`math`
+ 命令构成：
  ```cmake
  math(EXPR <var> "<str>" [OUTPUT_FORMAT <格式选项>])
  ```
  + 作用：计算`<str>`中的数学表达式结果，并将结果放到`<var>`内
  + 结果格式可通过可选参数`<格式选项>`指定
    + `HEXADECIMAL`：十六进制
    + `DECIMAL`：十进制
  + 运算符与 C 语言相同
  + 数值与计算结果都必须是一个64位有符号整数可表示的
<br>

#### 字符串操作：`string`
##### 搜索与替换
+ 搜索字符串
  ```cmake
  string(FIND <str> <substr> <var> [REVERSE])
  ```
  + `REVERSE`：指定自后向前搜索
  + 当查找内容不存在时，`<var>`将为`-1`
+ 替换字符串
  ```cmake
  string(REPLACE <substr><rep_str>
    <var>
  <str>[<str>...])
  ```
<br>

##### 正则匹配和替换
+ 正则表达式语法：
  ![](https://res.weread.qq.com/wrepub/CB_3300091899_5ZcAMEGSi5q801H9ec29.jpg)
  + 例子：匹配 `a+b`：
    ```cmake
    set(regex [[\(a\+b\)]])
    set(regex "\\(a\\+b\\)")
    ```
    + 第一种方法不转义时表现为`\(a\+b\)`，之后转义为`(a+b)`
    + 第二种方法因为是引号变量，需要先转义`\`，因此需要替代`\`为`\`
+ 单次正则匹配：
  ```cmake
  string(
    REGEX MATCH <正则表达式>
    <var>
    <str>[<str>...]
  )
  ```
+ 全部正则匹配：
  ```cmake
  string(
    REGEX MATCHALL <正则表达式>
    <var>
    <str> [<str>...]
  )
  ```
+ 正则替换
  ```cmake
  string(
    REGEX REPLACE <正则表达式>
    <替换表达式> <var>
    <str> [<str>...]
  )
  ```
  + 在`<替换表达式>`中，可以通过`\1~\9`分别引用第1个~第9个子表达式的匹配结果
    + 而`\0`表示匹配到完整字符串
+ 捕获组变量
  + 捕获组（`capture group`）即正则表达式中子表达式匹配的结果
  + 捕获组可以在正则替换表达式中通过反斜杠语法访问
  + 相关的预定义变量如下：
    + `CMAKE_MATCH_COUNT`代表捕获组的数量
    + `CMAKE_MATCH_<n>`代表第 n 个捕获组的匹配内容，当n为 0 时，值为正则匹配的完整结果而非子表达式的匹配结果
<br>

##### 取字符串长度
+ 代码：
  ```cmake
  string(LENGTH <str> <var>)
  ```
<br>

##### 字符串变换
+ 追加字符串：
  ```cmake
  string(APPEND <var> [<str>...])
  ```
+ 前插字符串：
  ```cmake
  string(CONCAT <var> [<str>...])
  ```
+ 分隔符连接：该命令将全部`<str>`以指定的分隔符分隔并连接，并存入`var`
  ```cmake
  string(JOIN <分隔符> <var> <str> [<str>...])
  ```
+ 大小写转换：
  ```cmake
  string(TOLOWER <str> <var>)
  string(WOUPPER <str> <var>)
  ```
+ 重复字符串：将`<str>`重复指定的`<重复次数>`
  ```cmake
  string(REPEAT <str> <重复次数> <var>)
  ```
+ 取子字符串：
  ```cmake
  string(SUBSTRING <str> <begin> <length> <var>)
  ```
  + 当`<begin> + <length> > len(<str>)`或者`<length>=-1`时，该命令会一直截取到`<str>`的末尾
+ 删除首尾空白符
  ```cmake
  string(STRIP <str> <var>)
  ```
+ 删除生成器表达式：删除`<str>`内的生成器表达式
  ```cmake
  string(GENEX_STRIP <str> <res>)
  ```
  + 生成器表达式是之后`CMake`会涉及的概念
<br>

##### 比较字符串
```cmake
string(COMPARE LESS <字符串1> <字符串2> <var>) # 小于
string(COMPARE GREATER <字符串1> <字符串2> <var>) # 大于
string(COMPARE EQUAL <字符串1> <字符串2> <var>) # 等于
string(COMPARE NOTEQUAL <字符串1> <字符串2> <var>) # 不等于
string(COMPARE LESS_EQUAL <字符串1> <字符串2> <var>) # 小于或等于
string(COMPARE GREATER_EQUAL <字符串1> <字符串2> <var>) # 大于或等于
```
+ 满足条件，则`<var>`中为 1，否则为 0
<br>

##### 取哈希值
+ `<哈希算法>`计算的加密哈希（`cryptographic hash`，又称加密散列、密码散列等）值
  ```cmake
  string(<哈希算法> <var> <str>)
  ```
  命令支持`MD5(Message-Digest, MD)`、`SHA1~SHA3`
<br>

##### 字符串模板
+ `CONFIGURE`命令：该命令将依照当前执行上下文中的变量对`<模板字符串>`进行配置，将结果存入`<var>`
  ```cmake
  string(CONFIGURE <模板字符串> <var> [@ONLY] [ESCAPE_QUOTES])
  ```
+ 变量模板：
  + 替换语法：
    + 一种与`CMake`变量引用语法一致
    + 另一种则用一对`@`包裹变量名，防止产生歧义
  + 在配置中指定`@ONLY`参数，即可规定变量模板语法只能使用第二种形式
+ 宏定义模板：
  + 形式：
    + 一种是值为0或1的宏定义
    + 另一种是定义值的宏定义，后一种形式的自定义值可为空值，用于表示存在性【值为假时会显示为`/* #undef <变量> */`】
      ```cmake
      <keyword>(template [=[
        #cmakedefine01 <变量>
        #cmakedefine <变量> [<val>]
      ]=])
      ```
+ 转义引号
  + 可选参数`ESCAPE_QUOTES`：用于指定是否需要转义用于模板替换的变量值中的引号
    + 若指定了该参数，则`CMake`将会使用C语言中的转义形式转义这些引号
<br>

##### JSON 操作
+ 错误处理
  + JSON操作的命令都会涉及两个参数：`<结果变量>`和`<错误变量>`
    + `<结果变量>`用于保存结果
    + `<错误变量>`会被赋值为`NOTFOUND`，表示没有错误
  + 当出现错误时，`<错误变量>`用于存放错误信息，`<结果变量>`用于存放出错的JSON键的路径，格式如下：
    ```cmake
    <JSON键>[-<JSON键>...]-NOTFOUND
    ```
+ 获取JSON元素值：该命令将解析`<JSON字符串>`，并根据指定的若干`<JSON键>`定位到对应JSON元素，获取其值，然后存入`<结果变量>`
  ```cmake
  string(
    JSON <结果变量> [ERROR_VARIABLE <错误变量>]
    GET <JSON字符串> [<JSON键>...]
  )
  ```
  + 如果定位到的JSON元素是一个JSON对象或数组，则获取的结果为对应元素的JSOM字符串表示
  + 如果其为布尔元素，则获取结果为`ON`或`OFF`
  + 如果其为空元素`null`，则获取的结果为空字符串
  + 其他情况下，获取的结果均为对应元素的字符串表示
+ 获取JSON元素类型
  ```cmake
  string(
    JSON <var> [ERROR_VARIABLE <错误变量>]
    TYPE <JSON字符串> [<JSON键>...]
  )
  ```
  + 结果变量，即`<var>`，包含以下类型：
    + `NULL`，空类型
    + `NUMBER`，数值类型
    + `STRING`，字符串类型
    + `BOOLEAN`，布尔类型
    + `ARRAY`，数组类型
    + `OBJECT`，对象类型